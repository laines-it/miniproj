<!-- templates/test.html -->
{% extends "base.html" %}

{% block content %}
<div class="gothic-container">
    <div class="gothic-card">
        <h1 class="gothic-title">–¢–µ—Å—Ç –Ω–∞ –õ–∏—é</h1>
        
        <div id="test-container">
            <!-- –¢–µ—Å—Ç –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <p class="gothic-footer">gothcringelord supremacy</p>
    </div>
</div>

<script>
    // –î–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞
    const questions = {{ questions|tojson }};
    let currentQuestion = 0;
    let points = 0;
    let selectedOption = null;

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞
    function renderQuestion() {
        const q = questions[currentQuestion];
        let html = `
            <div class="question-header">
                <div class="question-counter">–í–æ–ø—Ä–æ—Å ${currentQuestion + 1} –∏–∑ ${questions.length}</div>
                <h2 class="question-text">${q.question}</h2>
            </div>
            
            <div class="question-image">
                <img src="/static/${q.image}" alt="">
            </div>
            
            <div class="options-container">
        `;
        
        q.options.forEach((option, index) => {
            html += `
                <div class="option ${selectedOption === index ? 'selected' : ''}" 
                     onclick="selectOption(${index})">
                    ${option.text}
                </div>
            `;
        });
        
        html += `</div>`;
        
        // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –≤—ã–±—Ä–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏ –∫–Ω–æ–ø–∫—É
        if (selectedOption !== null) {
            const isCorrect = q.options[selectedOption].correct;
            if(isCorrect){
                points++;
            }
            html += `
                <div class="comment-box ${isCorrect ? 'correct' : 'incorrect'}">
                    <div class="comment-icon">${isCorrect ? '‚úì' : '‚úó'}</div>
                    <div class="comment-text">${isCorrect ? q.commentTrue : q.commentFalse}</div>
                </div>
                <button class="gothic-button next-button" onclick="nextQuestion()">–î–∞–ª—å—à–µ</button>
            `;
        }
        
        document.getElementById('test-container').innerHTML = html;
    }

    // –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞
    function selectOption(index) {
        if (selectedOption === null) {
            selectedOption = index;
            renderQuestion();
        }
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
    function nextQuestion() {
        currentQuestion++;
        selectedOption = null;
        
        if (currentQuestion < questions.length) {
            renderQuestion();
        } else {
            if (points >= questions.length) {
                document.getElementById('test-container').innerHTML = `
                    <div class="test-complete">
                        <div class="gothic-icon">üèÜ</div>
                        <h2>–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ!</h2>
                        <p>–î–∞–∂–µ –µ—Å–ª–∏ —Ç–µ—Å—Ç –±—ã–ª —Ö—É–π–Ω—è, —Ç–æ —Ç—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –∑–∞—Å–ª—É–∂–∏–ª–∞ –ø–æ–¥–∞—Ä–æ–∫</p>
                        <a href="https://ga.gift/ru/7f48823246d14c4c824cdd231227127c" target="_blank">–ü–æ–¥–∞—Ä–æ–∫üçé</a>
                        </div>
                `;
            } else {
                document.getElementById('test-container').innerHTML = `
                    <div class="test-complete">
                        <div class="gothic-icon">‚ò†Ô∏éÔ∏é</div>
                        <h2>–ù—É —Ç—ã —á–µ–≥–æ :(</h2>
                        <p>–ù–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏–ª–∞, —Å–ª–∏—à–∫–æ–º –ø–µ—Ä–µ–º–µ—Ç–∞–ø–æ—Å—Ç–∏—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∞</p>
                        <p><a href="{{ url_for('sanctuary') }}" class="gothic-link">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ–º–Ω–∞—Ç—É –≤–∞–π–±–∞</a></p>
                    </div>
                `;
            }
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = renderQuestion;
</script>

<style>
    .question-header {
        text-align: center;
        margin-bottom: 25px;
    }
    
    .question-counter {
        font-size: 1.1rem;
        color: var(--candle);
        letter-spacing: 1px;
        margin-bottom: 10px;
    }
    
    .question-text {
        font-family: 'Cinzel Decorative', cursive;
        color: var(--moonlight);
        font-size: 1.5rem;
        margin: 0;
    }
    
    .question-image {
        text-align: center;
        margin: 20px 0;
    }
    
    .question-image img {
        max-width: 100%;
        max-height: 200px;
        border: 2px solid var(--blood);
        box-shadow: 0 0 15px rgba(138, 3, 3, 0.5);
    }
    
    .options-container {
        margin: 30px 0;
    }
    
    .option {
        background: rgba(30, 30, 30, 0.7);
        border: 2px solid var(--stone);
        padding: 15px;
        margin: 12px 0;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1.2rem;
        text-align: center;
    }
    
    .option:hover {
        border-color: var(--blood);
        background: rgba(60, 10, 10, 0.7);
    }
    
    .option.selected {
        border-color: var(--candle);
        background: rgba(70, 20, 0, 0.8);
        box-shadow: 0 0 15px rgba(233, 185, 110, 0.5);
    }
    
    .comment-box {
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        display: flex;
        align-items: center;
        border-left: 4px solid;
    }
    
    .comment-box.correct {
        background: rgba(20, 60, 20, 0.6);
        border-left-color: #28a745;
    }
    
    .comment-box.incorrect {
        background: rgba(60, 20, 20, 0.6);
        border-left-color: #dc3545;
    }
    
    .comment-icon {
        font-size: 2rem;
        margin-right: 15px;
        width: 40px;
        text-align: center;
    }
    
    .comment-text {
        flex: 1;
        font-size: 1.1rem;
    }
    
    .next-button {
        margin-top: 15px;
    }
    
    .test-complete {
        text-align: center;
        padding: 30px 0;
    }
    
    .test-complete h2 {
        color: var(--candle);
        margin: 20px 0;
    }
</style>
{% endblock %}